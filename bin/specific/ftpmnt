#! /bin/bash

# login details go in ~/.netrc

declare -A _ftp_profiles
_ftp_profiles[ikn]="campbell.footholds.net"


ftpmnt () {
    local profile="$1"
    [ -z "$1" ] && {
        echo "using default profile: ikn"
        profile=ikn
    }
    local host="${_ftp_profiles["$profile"]}"

    [ -z "$host" ] && {
        echo "no such profile: $profile"
        return 2
    }

    dir="$FTP_DIR"/"$profile"
    mkdir -p "$dir"
    curlftpfs "$host" "$dir"
}


_complete_ftpmnt () {
    [ "$COMP_CWORD" -eq 1 ] && {
        local ifs="$IFS"
        IFS=$'\n'
        COMPREPLY=($(compgen -W "${!_ftp_profiles[@]}" "$2"))
        IFS="$ifs"
    }
}


complete -F _complete_ftpmnt ftpmnt
